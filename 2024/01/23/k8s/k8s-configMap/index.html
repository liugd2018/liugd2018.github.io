<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>k8s configMap | Programming Notes</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">k8s configMap</h1><a id="logo" href="/.">Programming Notes</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">k8s configMap</h1><div class="post-meta">2024-01-23<span> | </span><span class="category"><a href="/categories/kubernetes/">kubernetes</a></span></div><div class="post-content"><h3 id="configMap"><a href="#configMap" class="headerlink" title="configMap"></a>configMap</h3><p><strong>可变配置管理</strong></p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-pod-configmap/"><code>cofigMap</code></a> 卷 提供了向 Pod 注入配置数据的方法。 ConfigMap 对象中存储的数据可以被 <code>configMap</code> 类型的卷引用，然后被 Pod 中运行的 容器化应用使用。简单说config就是放置配置信息，加密信息可以使用<code>Secret</code>存放。</p>
<blockquote>
<p>说明</p>
<ul>
<li>在使用 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-pod-configmap/">ConfigMap</a> 之前你首先要创建它。</li>
<li>容器以 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#using-subpath">subPath</a> 卷挂载方式使用 ConfigMap 时，将无法接收 ConfigMap 的更新。</li>
<li>文本数据挂载成文件时采用 UTF-8 字符编码。如果使用其他字符编码形式，可使用 <code>binaryData</code> 字段。</li>
</ul>
</blockquote>
<h4 id="配置-Pod-使用-ConfigMap"><a href="#配置-Pod-使用-ConfigMap" class="headerlink" title="配置 Pod 使用 ConfigMap"></a>配置 Pod 使用 ConfigMap</h4><h5 id="创建-ConfigMap"><a href="#创建-ConfigMap" class="headerlink" title="创建 ConfigMap"></a>创建 ConfigMap</h5><p>你可以使用 <code>kubectl create configmap</code> 的 ConfigMap 生成器 来创建 ConfigMap。</p>
<h3 id="使用-kubectl-create-configmap-创建-ConfigMap"><a href="#使用-kubectl-create-configmap-创建-ConfigMap" class="headerlink" title="使用 kubectl create configmap 创建 ConfigMap"></a>使用 kubectl create configmap 创建 ConfigMap</h3><p>你可以使用 <code>kubectl create configmap</code> 命令基于 <code>目录</code>、<code>文件</code> 或者<code>字面值</code>来创建 ConfigMap：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;</span><br></pre></td></tr></table></figure>

<p>其中，map-name 是要设置的 ConfigMap 名称，data-source 是要从中提取数据的目录、 文件或者字面值。 ConfigMap 对象的名称必须是合法的 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/names#dns-subdomain-names">DNS 子域名</a>.</p>
<h4 id="基于目录创建-ConfigMap"><a href="#基于目录创建-ConfigMap" class="headerlink" title="基于目录创建 ConfigMap"></a>基于目录创建 ConfigMap</h4><p>你可以使用 <code>kubectl create configmap</code>  基于同一目录中的多个文件创建 ConfigMap。 当你基于目录来创建 ConfigMap 时，kubectl 识别目录下基本名可以作为合法键名的 文件，并将这些文件打包到新的 ConfigMap 中。普通文件之外的所有目录项都会被 忽略（例如，子目录、符号链接、设备、管道等等）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建本地目录</span></span><br><span class="line">mkdir -p configure-pod-container/configmap/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将实例文件下载到 `configure-pod-container/configmap/` 目录</span></span><br><span class="line">wget https://kubernetes.io/examples/configmap/game.properties -O configure-pod-container/configmap/game.properties</span><br><span class="line">wget https://kubernetes.io/examples/configmap/ui.properties -O configure-pod-container/configmap/ui.properties</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 configmap</span></span><br><span class="line">kubectl create configmap game-config --from-file=configure-pod-container/configmap/</span><br></pre></td></tr></table></figure>

<p>以上命令将 <code>configure-pod-container/configmap</code> 目录下的所有文件，也就是 <code>game.properties</code> 和 <code>ui.properties</code> 打包到 game-config ConfigMap 中。你可以使用下面的命令显示 ConfigMap 的详细信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe configmaps game-config</span><br></pre></td></tr></table></figure>

<p>输出类似以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">describe</span> <span class="string">configmaps</span> <span class="string">game-config</span></span><br><span class="line"><span class="attr">Name:</span>         <span class="string">game-config</span></span><br><span class="line"><span class="attr">Namespace:</span>    <span class="string">default</span></span><br><span class="line"><span class="attr">Labels:</span>       <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="attr">Annotations:</span>  <span class="string">&lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">Data</span></span><br><span class="line"><span class="string">====</span></span><br><span class="line"><span class="attr">game.properties:</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">enemies=aliens</span></span><br><span class="line"><span class="string">lives=3</span></span><br><span class="line"><span class="string">enemies.cheat=true</span></span><br><span class="line"><span class="string">enemies.cheat.level=noGoodRotten</span></span><br><span class="line"><span class="string">secret.code.passphrase=UUDDLRLRBABAS</span></span><br><span class="line"><span class="string">secret.code.allowed=true</span></span><br><span class="line"><span class="string">secret.code.lives=30</span></span><br><span class="line"><span class="attr">ui.properties:</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">color.good=purple</span></span><br><span class="line"><span class="string">color.bad=yellow</span></span><br><span class="line"><span class="string">allow.textmode=true</span></span><br><span class="line"><span class="string">how.nice.to.look=fairlyNice</span></span><br></pre></td></tr></table></figure>

<p><code>configure-pod-container/configmap/</code> 目录中的 <code>game.properties</code> 和 <code>ui.properties</code> 文件出现在 ConfigMap 的 <code>data</code> 部分。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmaps game-config -o yaml</span><br></pre></td></tr></table></figure>

<p>输出类似以下内容:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">game.properties:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    enemies=aliens</span></span><br><span class="line"><span class="string">    lives=3</span></span><br><span class="line"><span class="string">    enemies.cheat=true</span></span><br><span class="line"><span class="string">    enemies.cheat.level=noGoodRotten</span></span><br><span class="line"><span class="string">    secret.code.passphrase=UUDDLRLRBABAS</span></span><br><span class="line"><span class="string">    secret.code.allowed=true</span></span><br><span class="line"><span class="string">    secret.code.lives=30</span></span><br><span class="line"><span class="string"></span>  <span class="attr">ui.properties:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    color.good=purple</span></span><br><span class="line"><span class="string">    color.bad=yellow</span></span><br><span class="line"><span class="string">    allow.textmode=true</span></span><br><span class="line"><span class="string">    how.nice.to.look=fairlyNice</span></span><br><span class="line"><span class="string"></span><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2021-11-24T08:16:51Z&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">game-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;998292&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">e478f435-2cdc-4b9d-a6c6-a145f510bf90</span></span><br></pre></td></tr></table></figure>

<h4 id="基于文件创建-ConfigMap"><a href="#基于文件创建-ConfigMap" class="headerlink" title="基于文件创建 ConfigMap"></a>基于文件创建 ConfigMap</h4><p>你可以使用 <code>kubectl create configmap</code> 基于单个文件或多个文件创建 ConfigMap。</p>
<h5 id="from-file"><a href="#from-file" class="headerlink" title="from-file"></a>from-file</h5><h6 id="单个文件"><a href="#单个文件" class="headerlink" title="单个文件"></a>单个文件</h6><p>例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap game-config-2 --from-file=configure-pod-container/configmap/game.properties</span><br></pre></td></tr></table></figure>

<p>将产生以下 ConfigMap:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe configmaps game-config-2</span><br></pre></td></tr></table></figure>

<p>输出类似以下内容:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Name:</span>         <span class="string">game-config-2</span></span><br><span class="line"><span class="attr">Namespace:</span>    <span class="string">default</span></span><br><span class="line"><span class="attr">Labels:</span>       <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="attr">Annotations:</span>  <span class="string">&lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">Data</span></span><br><span class="line"><span class="string">====</span></span><br><span class="line"><span class="attr">game.properties:</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">enemies=aliens</span></span><br><span class="line"><span class="string">lives=3</span></span><br><span class="line"><span class="string">enemies.cheat=true</span></span><br><span class="line"><span class="string">enemies.cheat.level=noGoodRotten</span></span><br><span class="line"><span class="string">secret.code.passphrase=UUDDLRLRBABAS</span></span><br><span class="line"><span class="string">secret.code.allowed=true</span></span><br><span class="line"><span class="string">secret.code.lives=30</span></span><br><span class="line"><span class="attr">Events:</span>  <span class="string">&lt;none&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="多个文件"><a href="#多个文件" class="headerlink" title="多个文件"></a>多个文件</h6><p>例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap game-config-3 --from-file=configure-pod-container/configmap/game.properties --from-file=configure-pod-container/configmap/ui.properties</span><br></pre></td></tr></table></figure>

<p>描述上面创建的 <code>game-config-3</code> configmap</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe configmaps game-config-3</span><br></pre></td></tr></table></figure>

<p>输出以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Name:</span>         <span class="string">game-config-3</span></span><br><span class="line"><span class="attr">Namespace:</span>    <span class="string">default</span></span><br><span class="line"><span class="attr">Labels:</span>       <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="attr">Annotations:</span>  <span class="string">&lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">Data</span></span><br><span class="line"><span class="string">====</span></span><br><span class="line"><span class="attr">game.properties:</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">enemies=aliens</span></span><br><span class="line"><span class="string">lives=3</span></span><br><span class="line"><span class="string">enemies.cheat=true</span></span><br><span class="line"><span class="string">enemies.cheat.level=noGoodRotten</span></span><br><span class="line"><span class="string">secret.code.passphrase=UUDDLRLRBABAS</span></span><br><span class="line"><span class="string">secret.code.allowed=true</span></span><br><span class="line"><span class="string">secret.code.lives=30</span></span><br><span class="line"><span class="attr">ui.properties:</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">color.good=purple</span></span><br><span class="line"><span class="string">color.bad=yellow</span></span><br><span class="line"><span class="string">allow.textmode=true</span></span><br><span class="line"><span class="string">how.nice.to.look=fairlyNice</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Events:</span>  <span class="string">&lt;none&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="from-env-file"><a href="#from-env-file" class="headerlink" title="from-env-file"></a>from-env-file</h5><p>使用 <code>--from-env-file</code> 选项从环境文件创建 ConfigMap，例如：</p>
<p>Env 文件包含环境变量列表。 其中适用以下语法规则:</p>
<ul>
<li>Env 文件中的每一行必须为 VAR&#x3D;VAL 格式。</li>
<li>以＃开头的行（即注释）将被忽略。</li>
<li>空行将被忽略。</li>
<li>引号不会被特殊处理（即它们将成为 ConfigMap 值的一部分）。</li>
</ul>
<p>将示例文件下载到 <code>configure-pod-container/configmap/</code> 目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://kubernetes.io/examples/configmap/game-env-file.properties -O configure-pod-container/configmap/game-env-file.properties</span><br></pre></td></tr></table></figure>

<p>env 文件 <code>game-env-file.properties</code> 如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat configure-pod-container/configmap/game-env-file.propertiesenemies=alienslives=3allowed=&quot;true&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap game-config-env-file \</span><br><span class="line">--from-env-file=configure-pod-container/configmap/game-env-file.properties</span><br></pre></td></tr></table></figure>

<p>将产生以下 ConfigMap：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmap game-config-env-file -o yaml</span><br></pre></td></tr></table></figure>

<p>输出类似以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">allowed:</span> <span class="string">&#x27;&quot;true&quot;&#x27;</span></span><br><span class="line">  <span class="attr">enemies:</span> <span class="string">aliens</span></span><br><span class="line">  <span class="attr">lives:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2021-11-24T08:52:23Z&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">game-config-env-file</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;1001561&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">cacdb689-6257-46bd-b03c-caa94aef0bb0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：</strong> 当多次使用 <code>--from-env-file</code> 来从多个数据源创建 ConfigMap 时，仅仅最后一个 env 文件有效。</p>
</blockquote>
<h4 id="定义从文件创建-ConfigMap-时要使用的键"><a href="#定义从文件创建-ConfigMap-时要使用的键" class="headerlink" title="定义从文件创建 ConfigMap 时要使用的键"></a>定义从文件创建 ConfigMap 时要使用的键</h4><p>在使用 <code>--from-file</code> 参数时，你可以定义在 ConfigMap 的 <code>data</code> 部分出现键名， 而不是按默认行为使用文件名：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap game-config-3 --from-file=&lt;my-key-name&gt;=&lt;path-to-file&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;my-key-name&gt;</code> 是你要在 ConfigMap 中使用的键名，<code>&lt;path-to-file&gt;</code> 是你想要键表示数据源文件的位置。</p>
<p>例如:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap game-config-4 --from-file=game-special-key=configure-pod-container/configmap/game.properties</span><br></pre></td></tr></table></figure>

<p>将产生以下 ConfigMap:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmaps game-config-4 -o yaml</span><br></pre></td></tr></table></figure>

<p>输出类似以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">game-special-key:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    enemies=aliens</span></span><br><span class="line"><span class="string">    lives=3</span></span><br><span class="line"><span class="string">    enemies.cheat=true</span></span><br><span class="line"><span class="string">    enemies.cheat.level=noGoodRotten</span></span><br><span class="line"><span class="string">    secret.code.passphrase=UUDDLRLRBABAS</span></span><br><span class="line"><span class="string">    secret.code.allowed=true</span></span><br><span class="line"><span class="string">    secret.code.lives=30</span></span><br><span class="line"><span class="string"></span><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2021-11-24T08:55:27Z&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">game-config-4</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;1001844&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">a6da1a68-ce49-41c6-8db0-60bf3331ba13</span></span><br></pre></td></tr></table></figure>



<h4 id="根据字面值创建-ConfigMap"><a href="#根据字面值创建-ConfigMap" class="headerlink" title="根据字面值创建 ConfigMap"></a>根据字面值创建 ConfigMap</h4><h5 id="from-literal参数"><a href="#from-literal参数" class="headerlink" title="from-literal参数"></a>from-literal参数</h5><p>你可以将 <code>kubectl create configmap</code> 与 <code>--from-literal</code> 参数一起使用，从命令行定义文字值:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap special-config --from-literal=special.how=very --from-literal=special.type=charm</span><br></pre></td></tr></table></figure>

<p>你可以传入多个键值对。命令行中提供的每对键值在 ConfigMap 的 <code>data</code> 部分中均表示为单独的条目。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmaps special-config -o yaml</span><br></pre></td></tr></table></figure>

<p>输出类似以下内容:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">special.how:</span> <span class="string">very</span></span><br><span class="line">  <span class="attr">special.type:</span> <span class="string">charm</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2021-11-24T08:57:41Z&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;1002051&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">fa7bc2e1-5e01-43c6-a073-a9fde6a6e3b7</span></span><br></pre></td></tr></table></figure>



<h5 id="key-value形式的键值"><a href="#key-value形式的键值" class="headerlink" title="key-value形式的键值"></a>key-value形式的键值</h5><p>使用 <code>key-value</code> 形式的键值对来配置数据，这些数据可以在 Pod 里面使用，如下所示的资源清单：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span>  </span><br><span class="line"><span class="attr">name:</span> <span class="string">cm-demo</span>  </span><br><span class="line"><span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span>  </span><br><span class="line">	<span class="attr">data.1:</span> <span class="string">hello</span>  </span><br><span class="line">	<span class="attr">data.2:</span> <span class="string">world</span>  </span><br><span class="line"><span class="attr">config:</span> <span class="string">|</span>   </span><br><span class="line">	<span class="string">property.1=value-1</span>    </span><br><span class="line">	<span class="string">property.2=value-2</span>    </span><br><span class="line">	<span class="string">property.3=value-3</span></span><br></pre></td></tr></table></figure>

<p>其中配置数据在 <code>data</code> 属性下面进行配置，前两个被用来保存单个属性，后面一个被用来保存一个配置文件。</p>
<p>我们可以看到 <code>config</code> 后面有一个竖线符 <code>|</code>，这在 yaml 中表示保留换行，每行的缩进和行尾空白都会被去掉，而额外的缩进会被保留。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;apiVersion&quot;:</span> <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;config&quot;:</span> <span class="string">&quot;property.1=value-1\nproperty.2=value-2\nproperty.3=value-3\n&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data.1&quot;:</span> <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data.2&quot;:</span> <span class="string">&quot;world&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;kind&quot;:</span> <span class="string">&quot;ConfigMap&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;metadata&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;creationTimestamp&quot;:</span> <span class="string">&quot;2021-11-24T14:04:07Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;cm-demo&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;namespace&quot;:</span> <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;resourceVersion&quot;:</span> <span class="string">&quot;1030223&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;4b06b072-6732-4c32-98b6-760f3ff3d293&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了竖线之外还可以使用 <code>&gt;</code> 右尖括号，用来表示折叠换行，只有空白行才会被识别为换行，原来的换行符都会被转换成空格</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">cm-demo</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">	<span class="attr">data.1:</span> <span class="string">hello</span></span><br><span class="line">  <span class="attr">data.2:</span> <span class="string">world</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">  	property.1=value-1</span></span><br><span class="line"><span class="string">    property.2=value-2</span></span><br><span class="line"><span class="string">    property.3=value-3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">configmaps</span> <span class="string">cm-demo</span> <span class="string">-o</span> <span class="string">json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;apiVersion&quot;:</span> <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;config&quot;:</span> <span class="string">&quot;property.1=value-1 property.2=value-2 property.3=value-3\n&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data.1&quot;:</span> <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data.2&quot;:</span> <span class="string">&quot;world&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;kind&quot;:</span> <span class="string">&quot;ConfigMap&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;metadata&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;creationTimestamp&quot;:</span> <span class="string">&quot;2021-11-24T14:08:09Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;cm-demo&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;namespace&quot;:</span> <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;resourceVersion&quot;:</span> <span class="string">&quot;1030596&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;cd70ebdf-2519-4f97-8db0-5e62cbc3006f&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了这两个指令之外，我们还可以使用竖线和加号或者减号进行配合使用，<code>+</code> 表示保留文字块末尾的换行，<code>-</code> 表示删除字符串末尾的换行。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span>  </span><br><span class="line"><span class="attr">game.properties:</span> <span class="string">|-</span></span><br><span class="line">	<span class="string">enemies=aliens</span>    </span><br><span class="line">	<span class="string">lives=3</span></span><br><span class="line">  <span class="string">enemies.cheat=true</span></span><br><span class="line">  <span class="string">enemies.cheat.level=noGoodRotten</span></span><br><span class="line">  <span class="string">secret.code.pass</span></span><br><span class="line">  <span class="string">phrase=UUDDLRLRBABAS</span></span><br><span class="line">  <span class="string">secret.code.allowed=true</span></span><br><span class="line">  <span class="string">secret.code.lives=30</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMapmeta</span></span><br><span class="line"><span class="attr">data:</span>  <span class="string">creation</span></span><br><span class="line"><span class="attr">Timestamp:</span> <span class="string">&quot;2021-11-24T08:22:50Z&quot;</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">game-config-2</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">resourceVersion:</span> <span class="string">&quot;998844&quot;</span></span><br><span class="line"><span class="attr">uid:</span> <span class="string">888ae9d0-a425-4a86-bc1d-68e85632c563</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">configmaps</span> <span class="string">game-config-2</span> <span class="string">-o</span> <span class="string">json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;apiVersion&quot;:</span> <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;game.properties&quot;:</span> <span class="string">&quot;enemies=aliens\nlives=3\nenemies.cheat=true\nenemies.cheat.level=noGoodRotten\nsecret.code.passphrase=UUDDLRLRBABAS\nsecret.code.allowed=true\nsecret.code.lives=30&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;kind&quot;:</span> <span class="string">&quot;ConfigMap&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;metadata&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;creationTimestamp&quot;:</span> <span class="string">&quot;2021-11-24T08:22:50Z&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;game-config-2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;namespace&quot;:</span> <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;resourceVersion&quot;:</span> <span class="string">&quot;998844&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;888ae9d0-a425-4a86-bc1d-68e85632c563&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><code>ConfigMap</code> 创建成功了，那么我们应该怎么在 Pod 中来使用呢？我们说 <code>ConfigMap</code> 这些配置数据可以通过很多种方式在 Pod 里使用，主要有以下几种方式：</p>
<ul>
<li>设置环境变量的值</li>
<li>在容器里设置命令行参数</li>
<li>在数据卷里面挂载配置文件</li>
</ul>
<h5 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h5><h6 id="使用单个-ConfigMap-中的数据定义容器环境变量"><a href="#使用单个-ConfigMap-中的数据定义容器环境变量" class="headerlink" title="使用单个 ConfigMap 中的数据定义容器环境变量"></a>使用单个 ConfigMap 中的数据定义容器环境变量</h6><ol>
<li><p>在 ConfigMap 中将环境变量定义为键值对:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap special-config --from-literal=special.how=very</span><br></pre></td></tr></table></figure>


</li>
<li><p>将 ConfigMap 中定义的 <code>special.how</code> 值分配给 Pod 规范中的 <code>SPECIAL_LEVEL_KEY</code> 环境变量。</p>
<p><code>pods/pod-single-configmap-env-variable.yaml</code> </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Podmeta</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">dapi-test-pod</span></span><br><span class="line"><span class="attr">spec:</span>  </span><br><span class="line"><span class="attr">containers:</span>    </span><br><span class="line">	<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-container</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;env&quot;</span> ]</span><br><span class="line">  <span class="attr">env:</span>        <span class="comment"># Define the environment variable</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPECIAL_LEVEL_KEY</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">  <span class="attr">configMapKeyRef:</span>              <span class="comment"># The ConfigMap containing the value you want to assign to SPECIAL_LEVEL_KEY              </span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">special-config</span>              <span class="comment"># Specify the key associated with the value</span></span><br><span class="line">  <span class="attr">key: special.how  restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>

<p>创建 Pod:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/pods/pod-single-configmap-env-variable.yaml</span><br></pre></td></tr></table></figure>

<p>现在，Pod 的输出包含环境变量 <code>SPECIAL_LEVEL_KEY=very</code>。</p>
</li>
</ol>
<h6 id="使用来自多个-ConfigMap-的数据定义容器环境变量"><a href="#使用来自多个-ConfigMap-的数据定义容器环境变量" class="headerlink" title="使用来自多个 ConfigMap 的数据定义容器环境变量"></a>使用来自多个 ConfigMap 的数据定义容器环境变量</h6><ul>
<li><p>与前面的示例一样，首先创建 ConfigMap。</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/configmap/configmaps.yaml"><code>configmap/configmaps.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy configmap/configmaps.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">special.how:</span> <span class="string">very</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">log_level:</span> <span class="string">INFO</span></span><br></pre></td></tr></table></figure>

<p>创建 ConfigMap:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/configmap/configmaps.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Pod 规范中定义环境变量。</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/pod-multiple-configmap-env-variable.yaml"><code>pods/pod-multiple-configmap-env-variable.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy pods/pod-multiple-configmap-env-variable.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dapi-test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">k8s.gcr.io/busybox</span></span><br><span class="line">      <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;env&quot;</span> ]</span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPECIAL_LEVEL_KEY</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">special.how</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LOG_LEVEL</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">env-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">log_level</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>

<p>创建 Pod:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/pods/pod-multiple-configmap-env-variable.yaml</span><br></pre></td></tr></table></figure>

<p>现在，Pod 的输出包含环境变量 <code>SPECIAL_LEVEL_KEY=very</code> 和 <code>LOG_LEVEL=INFO</code>。</p>
</li>
</ul>
<h6 id="将-ConfigMap-中的所有键值对配置为容器环境变量"><a href="#将-ConfigMap-中的所有键值对配置为容器环境变量" class="headerlink" title="将 ConfigMap 中的所有键值对配置为容器环境变量"></a>将 ConfigMap 中的所有键值对配置为容器环境变量</h6><blockquote>
<p><strong>说明：</strong> Kubernetes v1.6 和更高版本支持此功能。</p>
</blockquote>
<ul>
<li><p>创建一个包含多个键值对的 ConfigMap。</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/configmap/configmap-multikeys.yaml"><code>configmap/configmap-multikeys.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy configmap/configmap-multikeys.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">SPECIAL_LEVEL:</span> <span class="string">very</span></span><br><span class="line">  <span class="attr">SPECIAL_TYPE:</span> <span class="string">charm</span></span><br></pre></td></tr></table></figure>

<p>创建 ConfigMap:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/configmap/configmap-multikeys.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>envFrom</code> 将所有 ConfigMap 的数据定义为容器环境变量，ConfigMap 中的键成为 Pod 中的环境变量名称。</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/pod-configmap-envFrom.yaml"><code>pods/pod-configmap-envFrom.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy pods/pod-configmap-envFrom.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dapi-test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">k8s.gcr.io/busybox</span></span><br><span class="line">      <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;env&quot;</span> ]</span><br><span class="line">      <span class="attr">envFrom:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>

<p>创建 Pod:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/pods/pod-configmap-envFrom.yaml</span><br></pre></td></tr></table></figure>

<p>现在，Pod 的输出包含环境变量 <code>SPECIAL_LEVEL=very</code> 和 <code>SPECIAL_TYPE=charm</code>。</p>
</li>
</ul>
<h5 id="在容器里设置命令行参数"><a href="#在容器里设置命令行参数" class="headerlink" title="在容器里设置命令行参数"></a>在容器里设置命令行参数</h5><h6 id="在-Pod-命令中使用-ConfigMap-定义的环境变量"><a href="#在-Pod-命令中使用-ConfigMap-定义的环境变量" class="headerlink" title="在 Pod 命令中使用 ConfigMap 定义的环境变量"></a>在 Pod 命令中使用 ConfigMap 定义的环境变量</h6><p>你可以使用 <code>$(VAR_NAME)</code> Kubernetes 替换语法在容器的 <code>command</code> 和 <code>args</code> 部分中使用 ConfigMap 定义的环境变量。</p>
<p>例如，以下 Pod 规范</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/pod-configmap-env-var-valueFrom.yaml"><code>pods/pod-configmap-env-var-valueFrom.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy pods/pod-configmap-env-var-valueFrom.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dapi-test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">k8s.gcr.io/busybox</span></span><br><span class="line">      <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo $(SPECIAL_LEVEL_KEY) $(SPECIAL_TYPE_KEY)&quot;</span> ]</span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPECIAL_LEVEL_KEY</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">SPECIAL_LEVEL</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPECIAL_TYPE_KEY</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">SPECIAL_TYPE</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>

<p>通过运行下面命令创建 Pod：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/pods/pod-configmap-env-var-valueFrom.yaml</span><br></pre></td></tr></table></figure>

<p>在 <code>test-container</code> 容器中产生以下输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">very charm</span><br></pre></td></tr></table></figure>

<h5 id="在数据卷里面挂载配置文件"><a href="#在数据卷里面挂载配置文件" class="headerlink" title="在数据卷里面挂载配置文件"></a>在数据卷里面挂载配置文件</h5><h6 id="将-ConfigMap-数据添加到一个卷中"><a href="#将-ConfigMap-数据添加到一个卷中" class="headerlink" title="将 ConfigMap 数据添加到一个卷中"></a>将 ConfigMap 数据添加到一个卷中</h6><p>如基于文件创建 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-pod-configmap/#create-configmaps-from-files">ConfigMap</a> 中所述，当你使用 <code>--from-file</code> 创建 ConfigMap 时，文件名成为存储在 ConfigMap 的 <code>data</code> 部分中的键， 文件内容成为键对应的值。</p>
<p>本节中的示例引用了一个名为 special-config 的 ConfigMap，如下所示：</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/configmap/configmap-multikeys.yaml"><code>configmap/configmap-multikeys.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy configmap/configmap-multikeys.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">SPECIAL_LEVEL:</span> <span class="string">very</span></span><br><span class="line">  <span class="attr">SPECIAL_TYPE:</span> <span class="string">charm</span></span><br></pre></td></tr></table></figure>

<p>创建 ConfigMap:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/configmap/configmap-multikeys.yaml</span><br></pre></td></tr></table></figure>

<h6 id="使用存储在-ConfigMap-中的数据填充数据卷"><a href="#使用存储在-ConfigMap-中的数据填充数据卷" class="headerlink" title="使用存储在 ConfigMap 中的数据填充数据卷"></a>使用存储在 ConfigMap 中的数据填充数据卷</h6><p>在 Pod 规约的 <code>volumes</code> 部分下添加 ConfigMap 名称。 这会将 ConfigMap 数据添加到指定为 <code>volumeMounts.mountPath</code> 的目录（在本例中为 <code>/etc/config</code>）。 <code>command</code> 部分引用存储在 ConfigMap 中的 <code>special.level</code>。</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/pod-configmap-volume.yaml"><code>pods/pod-configmap-volume.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy pods/pod-configmap-volume.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dapi-test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">k8s.gcr.io/busybox</span></span><br><span class="line">      <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;ls /etc/config/&quot;</span> ]</span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">configMap:</span></span><br><span class="line">        <span class="comment"># Provide the name of the ConfigMap containing the files you want</span></span><br><span class="line">        <span class="comment"># to add to the container</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>

<p>创建 Pod:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/pods/pod-configmap-volume.yaml</span><br></pre></td></tr></table></figure>

<p>Pod 运行时，命令 <code>ls /etc/config/</code> 产生下面的输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SPECIAL_LEVELSPECIAL_TYPE</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 如果在 <code>/etc/config/</code> 目录中有一些文件，它们将被删除。</p>
<p><strong>说明：</strong> 文本数据会使用 UTF-8 字符编码的形式展现为文件。如果使用其他字符编码， 可以使用 <code>binaryData</code>。</p>
<h6 id="将-ConfigMap-数据添加到数据卷中的特定路径"><a href="#将-ConfigMap-数据添加到数据卷中的特定路径" class="headerlink" title="将 ConfigMap 数据添加到数据卷中的特定路径"></a>将 ConfigMap 数据添加到数据卷中的特定路径</h6><p>使用 <code>path</code> 字段为特定的 ConfigMap 项目指定预期的文件路径。 在这里，ConfigMap中，键值 <code>SPECIAL_LEVEL</code> 的内容将挂载在 <code>config-volume</code> 数据卷中 <code>/etc/config/keys</code> 文件下。</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/pod-configmap-volume-specific-key.yaml"><code>pods/pod-configmap-volume-specific-key.yaml</code> </a><img src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" alt="Copy pods/pod-configmap-volume-specific-key.yaml to clipboard"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dapi-test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">k8s.gcr.io/busybox</span></span><br><span class="line">      <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /etc/config/keys&quot;</span> ]</span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">configMap:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">special-config</span></span><br><span class="line">        <span class="attr">items:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">SPECIAL_LEVEL</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">keys</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>

<p>创建Pod：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://kubernetes.io/examples/pods/pod-configmap-volume-specific-key.yaml</span><br></pre></td></tr></table></figure>

<p>当 pod 运行时，命令 <code>cat /etc/config/keys</code> 产生以下输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">very</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 如前，<code>/etc/config/</code> 目录中所有先前的文件都将被删除</p>
<h3 id="映射键以指定路径和文件权限"><a href="#映射键以指定路径和文件权限" class="headerlink" title="映射键以指定路径和文件权限"></a>映射键以指定路径和文件权限</h3><p>你可以通过指定键名到特定目录的投射关系，也可以逐个文件地设定访问权限。 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/configuration/secret/#using-secrets-as-files-from-a-pod">Secret 用户指南</a> 中对这一语法提供了解释。</p>
<h3 id="挂载的-ConfigMap-将自动更新"><a href="#挂载的-ConfigMap-将自动更新" class="headerlink" title="挂载的 ConfigMap 将自动更新"></a>挂载的 ConfigMap 将自动更新</h3><p>更新已经在数据卷中使用的 ConfigMap 时，已映射的键最终也会被更新。 <code>kubelet</code> 在每次定期同步时都会检查已挂载的 ConfigMap 是否是最新的。 但是，它使用其本地的基于 TTL 的缓存来获取 ConfigMap 的当前值。 因此，从更新 ConfigMap 到将新键映射到 Pod 的总延迟可能与 kubelet 同步周期 + ConfigMap 在 kubelet 中缓存的 TTL 一样长。</p>
<p><strong>说明：</strong> 使用 ConfigMap 作为 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#using-subpath">subPath</a> 的数据卷将不会收到 ConfigMap 更新。</p>
<h3 id="了解-ConfigMap-和-Pod"><a href="#了解-ConfigMap-和-Pod" class="headerlink" title="了解 ConfigMap 和 Pod"></a>了解 ConfigMap 和 Pod</h3><p>ConfigMap API 资源将配置数据存储为键值对。 数据可以在 Pod 中使用，也可以提供系统组件（如控制器）的配置。 ConfigMap 与 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/configuration/secret/">Secret</a> 类似， 但是提供了一种使用不包含敏感信息的字符串的方法。 用户和系统组件都可以在 ConfigMap 中存储配置数据。</p>
<p><strong>说明：</strong> ConfigMap 应该引用属性文件，而不是替换它们。可以将 ConfigMap 理解为类似于 Linux <code>/etc</code> 目录及其内容的东西。例如，如果你从 ConfigMap 创建 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/volumes/">Kubernetes 卷</a>，则 ConfigMap 中的每个数据项都由该数据卷中的单个文件表示。</p>
<p>ConfigMap 的 <code>data</code> 字段包含配置数据。如下例所示，它可以简单 （如用 <code>--from-literal</code> 的单个属性定义）或复杂 （如用 <code>--from-file</code> 的配置文件或 JSON blob定义）。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="number">2016-02-18T19:14:38Z</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># 使用 --from-literal 定义的简单属性</span></span><br><span class="line">  <span class="attr">example.property.1:</span> <span class="string">hello</span></span><br><span class="line">  <span class="attr">example.property.2:</span> <span class="string">world</span></span><br><span class="line">  <span class="comment"># 使用 --from-file 定义复杂属性的例子</span></span><br><span class="line">  <span class="attr">example.property.file:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    property.1=value-1</span></span><br><span class="line"><span class="string">    property.2=value-2</span></span><br><span class="line"><span class="string">    property.3=value-3 </span></span><br></pre></td></tr></table></figure>

<h4 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h4><ul>
<li><p>在 Pod 规范中引用之前，必须先创建一个 ConfigMap（除非将 ConfigMap 标记为”可选”）。 如果引用的 ConfigMap 不存在，则 Pod 将不会启动。同样，引用 ConfigMap 中不存在的键也会阻止 Pod 启动。</p>
</li>
<li><p>如果你使用 <code>envFrom</code> 基于 ConfigMap 定义环境变量，那么无效的键将被忽略。 可以启动 Pod，但无效名称将记录在事件日志中（<code>InvalidVariableNames</code>）。 日志消息列出了每个跳过的键。例如:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get events</span><br></pre></td></tr></table></figure>

<p>输出与此类似:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LASTSEEN FIRSTSEEN COUNT NAME          KIND  SUBOBJECT  TYPE      REASON                            SOURCE                MESSAGE0s       0s        1     dapi-test-pod Pod              Warning   InvalidEnvironmentVariableNames   &#123;kubelet, 127.0.0.1&#125;  Keys [1badkey, 2alsobad] from the EnvFrom configMap default/myconfig were skipped since they are considered invalid environment variable names.</span><br></pre></td></tr></table></figure>
</li>
<li><p>ConfigMap 位于特定的<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/namespaces/">名字空间</a> 中。每个 ConfigMap 只能被同一名字空间中的 Pod 引用.</p>
</li>
<li><p>你不能将 ConfigMap 用于 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/static-pod/">静态 Pod</a>， 因为 Kubernetes 不支持这种用法。</p>
</li>
</ul>
<blockquote>
<p>只有通过 Kubernetes API 创建的 Pod 才能使用 <code>ConfigMap</code>，其他方式创建的（比如静态 Pod）不能使用；ConfigMap 文件大小限制为 <code>1MB</code>（ETCD 的要求）。</p>
</blockquote>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a></li></ul></div><div class="post-nav"><a class="pre" href="/2024/01/23/k8s/k8s-Deployemnt%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/">k8s Deployemnt滚动更新</a><a class="next" href="/2024/01/23/java%E5%8E%8B%E6%B5%8B/%E8%AE%B0%E5%BD%95%E5%8E%8B%E6%B5%8B%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98/">记录压测出现问题</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://liugd2018.github.io"/></form></div><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://liugd2018.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.png"/></a><p>To be a better man.</p><a class="info-icon" href="mailto:liugd2020@gmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/liugd2018" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LIUNX/">LIUNX</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kubernetes/">kubernetes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/">leetcode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lombok/">lombok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongoDB/">mongoDB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/openvpn/">openvpn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%80%E5%85%A5java%E6%B7%B1%E4%BC%BC%E6%B5%B7/">一入java深似海</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8E%8B%E6%B5%8B/">压测</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93%E6%A8%A1%E6%8B%9F%E5%99%A8/">安卓模拟器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%B9%E5%99%A8/">容器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E9%A9%AC%E5%93%A5java%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">小马哥java进阶训练营</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/">数据结构与算法之美</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/">编程技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Elasticsearch/" style="font-size: 15px;">Elasticsearch</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/mac%E5%86%85%E5%BD%95/" style="font-size: 15px;">mac内录</a> <a href="/tags/lombok/" style="font-size: 15px;">lombok</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/MYSQL/" style="font-size: 15px;">MYSQL</a> <a href="/tags/MYSQL%E5%AE%9E%E6%88%9845%E8%AE%B2%E7%AC%94%E8%AE%B0/" style="font-size: 15px;">MYSQL实战45讲笔记</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 15px;">数据结构</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98/" style="font-size: 15px;">线上问题</a> <a href="/tags/JAVA/" style="font-size: 15px;">JAVA</a> <a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" style="font-size: 15px;">内网穿透</a> <a href="/tags/k8s%E5%8E%8B%E6%B5%8B/" style="font-size: 15px;">k8s压测</a> <a href="/tags/Hyper-V/" style="font-size: 15px;">Hyper-V</a> <a href="/tags/LIUNX/" style="font-size: 15px;">LIUNX</a> <a href="/tags/mongoDB/" style="font-size: 15px;">mongoDB</a> <a href="/tags/openvpn/" style="font-size: 15px;">openvpn</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 15px;">链表</a> <a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size: 15px;">数组</a> <a href="/tags/%E5%AE%89%E5%8D%93%E6%A8%A1%E6%8B%9F%E5%99%A8/" style="font-size: 15px;">安卓模拟器</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 15px;">笔记</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/Containerd/" style="font-size: 15px;">Containerd</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 15px;">操作系统</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/" style="font-size: 15px;">数据结构与算法之美</a> <a href="/tags/RabbitMQ/" style="font-size: 15px;">RabbitMQ</a> <a href="/tags/Spring-Cloud/" style="font-size: 15px;">Spring Cloud</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/MYSQL/%E7%BA%BF%E4%B8%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A0%B5%E5%A1%9E/">线上数据库连接数爆满导致堵塞</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%BE%8E/%E7%AE%97%E6%B3%95%E9%A6%96%E9%A1%B5-01/">数据结构和算法分类</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/%E5%AE%B9%E5%99%A8/Docker%E5%9F%BA%E7%A1%80/">Docker基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/%E5%AE%B9%E5%99%A8/Containerd-%E6%90%AD%E5%BB%BA%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8/">Containerd 搭建以及使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/byte%E4%B8%80%E4%B8%AA%E5%AD%97%E8%8A%82%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B0%8F%E8%8C%83%E5%9B%B4%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF-128~127/">byte一个字节的数据大小范围为什么是-128~127</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/%E5%AE%89%E5%8D%93%E6%A8%A1%E6%8B%9F%E5%99%A8/MAC-%E7%BD%91%E6%98%93mumu%E5%AE%89%E5%8D%93%E6%A8%A1%E6%8B%9F%E5%99%A8%E4%BF%AE%E6%94%B9hosts/">MAC 网易mumu安卓模拟器修改hosts</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/VM/%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0%E5%AE%BF%E4%B8%BB%E6%9C%BA%E5%86%85%E9%83%A8centos%E8%99%9A%E6%8B%9F%E6%9C%BA/">内网访问不到宿主机内部centos虚拟机</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/TOOL/pierced%EF%BC%9A%E9%92%89%E9%92%89%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/">pierced钉钉内网穿透，仅支持80/443端口</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/Spring/SpringCloud/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">负载均衡</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/23/Spring/SpringCloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/">服务注册与发现</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">Programming Notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>